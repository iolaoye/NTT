<% if @errors != nil %>
  <% if @errors.length > 0 %>
    <div id="error_explanation">
      <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
      <h2><%= t('activerecord.run_errors', :count => @errors.count, :model => t('models.result').downcase) %></h2>
      <ul>
        <% @errors.each do |error| %>
            <li><%= error %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
<% end %>
<% if flash[:info] %>
  <div class="flash_alert">
    <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
    <%= flash[:info] %>
  </div>
<% end %>
<div class="page-header"><h1><%=@type + " " %><%= t('result.upto12') unless @type != t('menu.results') + ': ' + t('result.annual') + "-" + t('result.charts')  %></h1></div>
<form id="myForm">
	<div class="field">
	    <table>
	      	<tr>
	        	<% if session[:simulation] == 'scenario' %>
	        		<h4><%= t('result.select_prompt_scenario') %></h4>
	        	<% else %>
	        		<h4><%= t('result.select_prompt_watershed') %></h4>
	        	<% end %>
	      	</tr>
	      	<tr>
			    <% field_id = 0 %>
		        <% if session[:simulation] == 'scenario' %>
				  <% field_id = @field.id %>
		          <td><%= collection_select :result1, :scenario_id, @field.scenarios.where("last_simulation > ?", 0), :id, :name, {:include_blank => t('result.select_scenario1'), :selected => @scenario1}, {:required => true, :style =>"width:150px"} %></td>
		          <td><%= collection_select :result2, :scenario_id, @field.scenarios.where("last_simulation > ?",0), :id, :name, {:include_blank => t('result.select_scenario2'), :selected => @scenario2}, {:required => false, :style =>"width:150px"}  %></td>
		          <td><%= collection_select :result3, :scenario_id, @field.scenarios.where("last_simulation > ?", 0), :id, :name, {:include_blank => t('result.select_scenario3'), :selected => @scenario3}, {:required => false, :style =>"width:150px"} %></td>
		        <% else %>
		          <td><%= collection_select :result1, :scenario_id, @project.location.watersheds, :id, :name, {:include_blank => t('result.select_watershed1'), :selected => @scenario1}, {:required => true, :style => "width:160px"} %></td>
		          <td><%= collection_select :result2, :scenario_id, @project.location.watersheds, :id, :name, {:include_blank => t('result.select_watershed2'), :selected => @scenario2}, {:required => false, :style =>"width:160px"} %></td>
		          <td><%= collection_select :result3, :scenario_id, @project.location.watersheds, :id, :name, {:include_blank => t('result.select_watershed3'), :selected => @scenario3}, {:required => false, :style =>"width:160px"} %></td>
		        <% end %>
		        <% case @type %>
		        <% when t('general.view'), t('result.summary'), "Tabular" %>
	              	<td>
	    		        <%= radio_button_tag :result_type, "acre", true  %> <%= t('result.units_ac') %>
	    		        <%= radio_button_tag :result_type, "total"%> <%= t('result.total_units') %>
	    	        </td>
	            	<td><%= submit_tag t("general.view"), :id => "summary", name: "button", :class => "btn btn-primary" %>
						<% if @results1 != nil %>
							<% if !request.url.include?(url_for("/fields/0/results?")) %>
								<%= link_to t('result.download_pdf'), { :format => :pdf }, :id => "pdf_download", name: "button", :class => "btn btn-primary" %>
							<% end %>
						    <!-- Download CSV/Excel button -->
						    <%# todo un comment this when the excel program that dowenload the excel files is fixed by Brandon. %>
						    <%= link_to t('result.download_excel'), results_path(:format => :xlsx, :result1 => {:scenario_id => @scenario1}, :result2 => {:scenario_id => @scenario2}, :result3 => {:scenario_id => @scenario3}, :project_id => @project.id, :field_id => field_id), :id => "excel_download", name: "button", :class => "btn btn-primary" %>
						<% end %>
					</td>
						<tr><td colspan = "3"><%= "(±) = " + t('result.confidence') %></td></tr>
		        <% when t("result.summary") + " " + t("result.by_soil"), t("general.view") + " " + t("result.by_soil")  %>
	              	<td>
	    		        <%= radio_button_tag :result_type, "acre", true  %> <%= t('result.units_ac') %>
	    		        <%= radio_button_tag :result_type, "total"%> <%= t('result.total_units') %>
	    	        </td>
	                <td><%= collection_select :result4, :soil_id, Soil.where(:field_id => @field.id, :selected => true), :id, :name, {:prompt => t('soil.select_soil'), :selected => @soil }, { :required => true }%></td>
			            <td><%= submit_tag t("general.view") + " " + t("result.by_soil"), name: "button", :class => "btn btn-primary" %>
						</tr>
						<tr ><td colspan = "3"><%= "(±) = " + t('result.confidence') %></td></tr>
	          	<% when t('result.annual')  + "-" + t('result.charts'), t("general.view") + " " + t('result.annual')  + "-" + t('result.charts')%>
		            <% if I18n.locale.eql?(:en) %>
		              <td><%= collection_select :result5_category, :group_id, Group.all, :id, :group_name, {:prompt => t('result.select_category'), :selected => @group}, {:required => true} %></td>
		              <td><%= collection_select :result5, :description_id, @descriptions.where(:group_id => @group), :id, :description, {:prompt => t('result.select_category'), :selected => @description}, {:required => true} %></td>
					  <td><%#= select :result5, :description_id, options_for_select(@des.map { |obj| [obj['description'], obj['id']] }) %>
		            <% else %>
		              <td><%= collection_select :result5_category, :group_id, Group.all, :id, :spanish_group_name, {:prompt => t('result.select_category'), :selected => @group}, {:required => true} %></td>
		              <td><%= collection_select :result5, :description_id, @descriptions.where("id != 52"), :id, :spanish_description, {:prompt => t('result.select_category'), :selected => @description}, {:required => true} %></td>
		            <% end %>
					<% if I18n.locale.eql?(:en) %>
						<td id="td_crops" style="display:none"><%= collection_select :result7, :crop_id, @crops, :crop_id, :name, {:prompt => t('result.select_crop'), :selected => @crop} %></td>
					<% else %>
						<td id="td_crops" style="display:none"><%= collection_select :result7, :crop_id, @crops, :crop_id, :spanish_name, {:prompt => t('result.select_crop'), :selected => @crop} %></td>
					<% end %>
		            <td>
		            	<%= submit_tag t("general.view"), name: "button_annual", :class => "btn btn-primary" %>
		            </td>
					</tr>
	        	<% when t('result.monthly') + "-" + t('result.charts'), t("general.view") + " " + t('result.monthly') + "-" + t('result.charts') %>
		            <% if I18n.locale.eql?(:en) %>
		              <td><%= collection_select :result6, :description_id, Description.where("period = 1"), :id, :description, {:prompt => t('result.select_chart'), :selected => @description}, {:required => true} %></td>
		            <% else %>
		              <td><%= collection_select :result6, :description_id, Description.where("period = 1"), :id, :spanish_description, {:prompt => t('result.select_chart'), :selected => @description}, {:required => true} %></td>
		            <% end %>
		            <td><%= submit_tag t("general.view"), name: "button_monthly", :class => "btn btn-primary" %></td>
	        	<% end %>
			</tr>
	        <%= hidden_field(:language, :language, :value => I18n.locale) %>
	        <%= hidden_field(:session, :name, :value => session[:simulation]) %>
	    </table>
	</div>
</form>
<% if @type == "Tabular" then %>
	<div id="tbl_detailed" class="table-responsive">
	  <div class="panel panel-default">
		<table class='table table-bordered', style="white-space: nowrap;">
		  	<thead> <!-- titles -->
			  	<tr class='gvHeaderStyle' >
			  		<th></th>
			  		<% if session[:simulation] == 'scenario' %>
						<% if @scenario1 == "0" || @scenario1 == "" %> <th style="text-align:center"><%= t('result.scenario1') %></th> <% else %> <th style="text-align:center"><%=Scenario.find(@scenario1).name%></th><%end%>
						<% if @scenario2 == "0" || @scenario2 == "" %> <th colspan="2" style="text-align:center"><%= t('result.scenario2') %></th> <% else %> <th colspan="2" style="text-align:center"><%=Scenario.find(@scenario2).name%></th><%end%>
						<% if @scenario3 == "0" || @scenario3 == "" %> <th colspan="2" style="text-align:center"><%= t('result.scenario3') %></th> <% else %> <th colspan="2" style="text-align:center"><%=Scenario.find(@scenario3).name%></th><%end%>
					<% else %>
						<% if !@scenario1 == "0" || @scenario1 == "" %> <th style="text-align:center"><%= t('result.scenario1') %></th> <% else %> <th style="text-align:center"><%=Watershed.find(@scenario1).name%></th><%end%>
						<% if !@scenario2 == "0" || @scenario2 == "" %> <th colspan="2" style="text-align:center"><%= t('result.scenario2') %></th> <% else %> <th colspan="2" style="text-align:center"><%=Watershed.find(@scenario2).name%></th><%end%>
						<% if !@scenario3 == "0" || @scenario3 == "" %> <th colspan="2" style="text-align:center"><%= t('result.scenario3') %></th> <% else %> <th colspan="2" style="text-align:center"><%=Watershed.find(@scenario3).name%></th><%end%>
					<% end %>
			  	</tr>
				<tr class='gvHeaderStyle'>
					<th style="border-right: thick double #ff0000" ><%= t('result.description') %></th>
					<th style="border-right: thick double #ff0000" ><%= "Losses(±)" %></th>
					<th ><%= "Losses(±)" %></th>
					<th style="border-right: thick double #ff0000"><%= t('general.change') + "(%)"%></th>
					<th ><%= "Losses(±)" %></th>
					<th ><%= t('general.change') + "(%)"%></th>
				</tr>
		  	</thead>
		  	<tbody>
		  		<% t = "s" %>
				<%# else %>
				<% row_id = t + "row" + "20" %>
				<% @id = "scenario_id" %>
				<% if session[:simulation] != "scenario" then %>
					<% @id = "watershed_id" %>
				<% end %>
				<% if @scenario1 != "0" then %>
					<% require 'enumerable/confidence_interval' %>
					<% results_data1 = AnnualResult.select('*','no3-qn as no3', 'flow-surface_flow as flow').where(:sub1 => 0, :"#{@id}" => @scenario1) %>
					<% cis1 = results_data1.group_by(&:sub1).map { |k, v| [k, v.map(&:orgn).confidence_interval, v.map(&:qn).confidence_interval, v.map(&:no3).confidence_interval, v.map(&:qdrn).confidence_interval, v.map(&:orgp).confidence_interval, v.map(&:po4).confidence_interval, v.map(&:qdrp).confidence_interval, v.map(&:surface_flow).confidence_interval, v.map(&:flow).confidence_interval, v.map(&:qdr).confidence_interval, v.map(&:irri).confidence_interval, v.map(&:dprk).confidence_interval, v.map(&:sed).confidence_interval, v.map(&:ymnu).confidence_interval] } %>
					<% averages1 = AnnualResult.where(:sub1 => 0, :"#{@id}" => @scenario1).pluck('avg(orgn)', 'avg(qn)', 'avg(no3-qn)', 'avg(qdrn)', 'avg(orgp)', 'avg(po4)', 'avg(qdrp)', 'avg(surface_flow)', 'avg(flow-surface_flow)', 'avg(qdr)', 'avg(irri)', 'avg(dprk)', 'avg(sed)', 'avg(ymnu)') %>
					<% crops1 = CropResult.where(@id + " = ? AND (yldg + yldf) > ?", @scenario1, 0).order("name").group(:name).pluck('avg(yldg) + avg(yldf)', 'avg(ws)', 'avg(ns)', 'avg(ps)', 'avg(ts)', 'name')%>
					<% crops_data1 = CropResult.select('*', 'yldg+yldf AS yield').where(@id + " = ? AND yldg+yldf > ?", @scenario1, 0) %>
					<% cic1 = Hash[*crops_data1.group_by(&:name).map { |k,v| [k, v.map(&:yield).confidence_interval]}.flatten] %>
					<%# cic1 = crops_data1.group_by(&:name).map { |k,v| [k, v.map(&:yield).confidence_interval]} %>
					<% averages2 = nil %>
					<% if @scenario2 != "0" && @scenario2 != "" then %>
						<% results_data2 = AnnualResult.select('*','no3-qn as no3', 'flow-surface_flow as flow').where(:sub1 => 0,  :"#{@id}" => @scenario2) %>
						<% cis2 = results_data2.group_by(&:sub1).map { |k, v| [k, v.map(&:orgn).confidence_interval, v.map(&:qn).confidence_interval, v.map(&:no3).confidence_interval, v.map(&:qdrn).confidence_interval, v.map(&:orgp).confidence_interval, v.map(&:po4).confidence_interval, v.map(&:qdrp).confidence_interval, v.map(&:surface_flow).confidence_interval, v.map(&:flow).confidence_interval, v.map(&:qdr).confidence_interval, v.map(&:irri).confidence_interval, v.map(&:dprk).confidence_interval, v.map(&:sed).confidence_interval, v.map(&:ymnu).confidence_interval] } %>
						<% averages2 = AnnualResult.where(:sub1 => 0, :"#{@id}" => @scenario2).pluck('avg(orgn)', 'avg(qn)', 'avg(no3-qn)', 'avg(qdrn)', 'avg(orgp)', 'avg(po4)', 'avg(qdrp)', 'avg(surface_flow)', 'avg(flow-surface_flow)', 'avg(qdr)', 'avg(irri)', 'avg(dprk)', 'avg(sed)', 'avg(ymnu)') %>
						<% crops2 = CropResult.where(@id + " = ? AND (yldg + yldf) > ?", @scenario2, 0).order("name").group(:name).pluck('avg(yldg) + avg(yldf)', 'avg(ws)', 'avg(ns)', 'avg(ps)', 'avg(ts)', 'name')%>
						<% crops_data2 = CropResult.select('*', 'yldg+yldf AS yield').where(@id + " = ? AND yldg+yldf > ?", @scenario2, 0) %>
						<% cic2 = Hash[*crops_data2.group_by(&:name).map { |k,v| [k, v.map(&:yield).confidence_interval]}.flatten] %>
						<% if @scenario3 != "0" && @scenario2 != ""  then %>
							<% results_data3 = AnnualResult.select('*','no3-qn as no3', 'flow-surface_flow as flow').where(:sub1 => 0,  :"#{@id}" => @scenario3) %>
							<% cis3 = results_data3.group_by(&:sub1).map { |k, v| [k, v.map(&:orgn).confidence_interval, v.map(&:qn).confidence_interval, v.map(&:no3).confidence_interval, v.map(&:qdrn).confidence_interval, v.map(&:orgp).confidence_interval, v.map(&:po4).confidence_interval, v.map(&:qdrp).confidence_interval, v.map(&:surface_flow).confidence_interval, v.map(&:flow).confidence_interval, v.map(&:qdr).confidence_interval, v.map(&:irri).confidence_interval, v.map(&:dprk).confidence_interval, v.map(&:sed).confidence_interval, v.map(&:ymnu).confidence_interval] } %>
							<% averages3 = AnnualResult.where(:sub1 => 0, :"#{@id}" => @scenario3).pluck('avg(orgn)', 'avg(qn)', 'avg(no3-qn)', 'avg(qdrn)', 'avg(orgp)', 'avg(po4)', 'avg(qdrp)', 'avg(surface_flow)', 'avg(flow-surface_flow)', 'avg(qdr)', 'avg(irri)', 'avg(dprk)', 'avg(sed)', 'avg(ymnu)') %>
							<% crops3 = CropResult.where(@id + " = ? AND (yldg + yldf) > ?", @scenario3, 0).order("name").group(:name).pluck('avg(yldg) + avg(yldf)', 'avg(ws)', 'avg(ns)', 'avg(ps)', 'avg(ts)', 'name')%>
							<% crops_data3 = CropResult.select('*', 'yldg+yldf AS yield').where(@id + " = ? AND yldg+yldf > ?", @scenario3, 0) %>
							<% cic3 = Hash[*crops_data3.group_by(&:name).map { |k,v| [k, v.map(&:yield).confidence_interval]}.flatten] %>
						<% end %>
					<% end %>
					<tr class="gvRowStyleOdd", id = <%=row_id%>>
						<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
							<a id="show1" class="gvTotalText"><%= "Total N" + " (" + "lbs/ac" + ")" %></a>
							<%= check_box_tag "Total N" %>
						</th>
						<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9">
							<%= sprintf("%8.1f", averages1[0][0]+averages1[0][1]+averages1[0][2]+averages1[0][3]) + " (" + sprintf("%8.1f",cis1[0][1]+cis1[0][2]+cis1[0][3]+cis1[0][4]) + ")" %>
						</td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvTotalText" style="background-color:#DEFFFD">
								<%= sprintf("%8.1f", averages2[0][0]+averages2[0][1]+averages2[0][2]+averages2[0][3]) + " (" + sprintf("%8.1f",cis2[0][1]+cis2[0][2]+cis2[0][3]+cis2[0][4]) + ")" %>
							</td>
							<% difference1 = averages2[0][0]+averages2[0][1]+averages2[0][2]+averages2[0][3]-(averages1[0][0]+averages1[0][1]+averages1[0][2]+averages1[0][3]) %>
							<% reduction1 = difference1 / (averages1[0][0]+averages1[0][1]+averages1[0][2]+averages1[0][3]) * 100 %>
							<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
						<% end %>
						<% if @scenario3!= "0" && @scenario3 != "" then %>
							<td class="gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", averages3[0][0]+averages3[0][1]+averages3[0][2]+averages3[0][3]) + " (" + sprintf("%8.1f",cis3[0][1]+cis3[0][2]+cis3[0][3]+cis3[0][4]) + ")" %></td>
							<% difference1 = averages3[0][0]+averages3[0][1]+averages3[0][2]+averages3[0][3]-(averages1[0][0]+averages1[0][1]+averages1[0][2]+averages1[0][3]) %>
							<% reduction1 = difference1 / (averages1[0][0]+averages1[0][1]+averages1[0][2]+averages1[0][3]) * 100 %>
							<td class= "gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "21" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show2" class="gvTotalText"><%= "Org N" + " (" + "lbs/ac" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][0]).to_s + " (" + sprintf("%8.1f", cis1[0][1]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][0]) + " (" + sprintf("%8.1f", cis2[0][1]) + ")" %></td>
							<td class=<%= if averages2[0][0]-averages1[0][0] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][0]-averages1[0][0]) + " (" + sprintf("%8.2f", ((averages2[0][0]-averages1[0][0]) / averages1[0][0]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][0]) + " (" + sprintf("%8.1f", cis3[0][1]) + ")" %></td>
							<td class=<%= if averages3[0][0]-averages1[0][0] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][0]-averages1[0][0]) + " (" + sprintf("%8.2f", ((averages3[0][0]-averages1[0][0]) / averages1[0][0]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "22" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show3" class="gvTotalText"><%= "Runoff N" + " (" + "lbs/ac" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][1]).to_s + " (" + sprintf("%8.1f", cis1[0][2]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][1]) + " (" + sprintf("%8.1f", cis2[0][2]) + ")" %></td>
							<td class=<%= if averages2[0][1]-averages1[0][1] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][1]-averages1[0][1]) + " (" + sprintf("%8.2f", ((averages2[0][1]-averages1[0][1]) / averages1[0][1]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][1]) + " (" + sprintf("%8.1f", cis3[0][2]) + ")" %></td>
							<td class=<%= if averages3[0][1]-averages1[0][1] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][1]-averages1[0][1]) + " (" + sprintf("%8.2f", ((averages3[0][1]-averages1[0][1]) / averages1[0][1]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "23" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show4" class="gvTotalText"><%= "Subsurface N" + " (" + "lbs/ac" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][2]).to_s + " (" + sprintf("%8.1f", cis1[0][3]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][2]) + " (" + sprintf("%8.1f", cis2[0][3]) + ")" %></td>
							<td class=<%= if averages2[0][2]-averages1[0][2] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][2]-averages1[0][2]) + " (" + sprintf("%8.2f", ((averages2[0][2]-averages1[0][2]) / averages1[0][2]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][2]) + " (" + sprintf("%8.1f", cis3[0][3]) + ")" %></td>
							<td class=<%= if averages3[0][2]-averages1[0][2] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][2]-averages1[0][2]) + " (" + sprintf("%8.2f", ((averages3[0][2]-averages1[0][2]) / averages1[0][2]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "24" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show5" class="gvTotalText"><%= "Tile Drain N" + " (" + "lbs/ac" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][3]).to_s + " (" + sprintf("%8.1f", cis1[0][4]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][3]) + " (" + sprintf("%8.1f", cis2[0][4]) + ")" %></td>
							<td class=<%= if averages2[0][3]-averages1[0][3] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][3]-averages1[0][3]) + " (" + sprintf("%8.1f", ((averages2[0][3]-averages1[0][3]) / averages1[0][3]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][3]) + " (" + sprintf("%8.1f", cis3[0][4]) + ")" %></td>
							<td class=<%= if averages3[0][3]-averages1[0][3] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][3]-averages1[0][3]) + " (" + sprintf("%8.1f", ((averages3[0][3]-averages1[0][3]) / averages1[0][3]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<%# P values %>
					<% row_id = t + "row" + "30" %>
					<tr class="gvRowStyleOdd", id = <%=row_id%>>
						<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
							<a class="gvTotalText"><%= "Total P" + " (" + "lbs/ac" + ")" %></a>
							<%= check_box_tag "Total P" %>
						</th>
						<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.1f", averages1[0][4]+averages1[0][5]+averages1[0][6]) + " (" + sprintf("%8.1f",cis1[0][5]+cis1[0][6]+cis1[0][7]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvTotalText" style="background-color:#DEFFFD"><%= sprintf("%8.1f", averages2[0][4]+averages2[0][5]+averages2[0][6]) + " (" + sprintf("%8.1f",cis2[0][5]+cis2[0][6]+cis2[0][7]) + ")" %></td>
							<% difference1 = averages2[0][4]+averages2[0][5]+averages2[0][6]-(averages1[0][4]+averages1[0][5]+averages1[0][6]) %>
							<% reduction1 = difference1 / (averages1[0][4]+averages1[0][5]+averages1[0][6]) * 100 %>
							<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", averages3[0][4]+averages3[0][5]+averages3[0][6]) + " (" + sprintf("%8.1f",cis3[0][5]+cis3[0][6]+cis3[0][7]) + ")" %></td>
							<% difference1 = averages3[0][4]+averages3[0][5]+averages3[0][6]-(averages1[0][4]+averages1[0][5]+averages1[0][6]) %>
							<% reduction1 = difference1 / (averages1[0][4]+averages1[0][5]+averages1[0][6]) * 100 %>
							<td class= "gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "31" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show6" class="gvTotalText"><%= "Org P" + " (" + "lbs/ac" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][4]).to_s + " (" + sprintf("%8.1f", cis1[0][5]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][4]) + " (" + sprintf("%8.1f", cis2[0][5]) + ")" %></td>
							<td class=<%= if averages2[0][4]-averages1[0][4] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][4]-averages1[0][4]) + " (" + sprintf("%8.2f", ((averages2[0][4]-averages1[0][4]) / averages1[0][4]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][4]) + " (" + sprintf("%8.1f", cis3[0][5]) + ")" %></td>
							<td class=<%= if averages3[0][4]-averages1[0][4] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][4]-averages1[0][4]).to_s + " (" + sprintf("%8.2f", ((averages3[0][4]-averages1[0][4]) / averages1[0][4]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "32" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show7" class="gvTotalText"><%= "PO4" + " (" + "lbs/ac" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][5]).to_s + " (" + sprintf("%8.1f", cis1[0][6]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][5])+ " (" + sprintf("%8.1f", cis2[0][6]) + ")" %></td>
							<td class=<%= if averages2[0][5]-averages1[0][5] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][5]-averages1[0][5]) + " (" + sprintf("%8.2f", ((averages2[0][5]-averages1[0][5]) / averages1[0][5]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][5]) + " (" + sprintf("%8.1f", cis3[0][6]) + ")" %></td>
							<td class=<%= if averages3[0][5]-averages1[0][5] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][5]-averages1[0][5]) + " (" + sprintf("%8.2f", ((averages3[0][5]-averages1[0][5]) / averages1[0][5]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "33" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show8" class="gvTotalText"><%= "Tile Drain P" + " (" + "lbs/ac" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][6]).to_s + " (" + sprintf("%8.1f", cis1[0][7]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][6]) + " (" + sprintf("%8.1f", cis2[0][7]) + ")" %></td>
							<td class=<%= if averages2[0][6]-averages1[0][6] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][6]-averages1[0][6]) + " (" + sprintf("%8.2f", ((averages2[0][6]-averages1[0][6]) / averages1[0][6]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][6]) + " (" + sprintf("%8.1f", cis3[0][7]) + ")" %></td>
							<td class=<%= if averages3[0][6]-averages1[0][6] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][6]-averages1[0][6]) + " (" + sprintf("%8.2f", ((averages3[0][6]-averages1[0][6]) / averages1[0][6]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<%# Flow values %>
					<% row_id = t + "row" + "40" %>
					<tr class="gvRowStyleOdd", id = <%=row_id%>>
						<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
							<a class="gvTotalText"><%= "Surface/Subsurface/Tile Drain Flow" + " (" + "in" + ")" %></a>
							<%= check_box_tag "Total P" %>
						</th>
						<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.1f", averages1[0][7]+averages1[0][8]+averages1[0][9]) + " (" + sprintf("%8.1f",cis1[0][8]+cis1[0][9]+cis1[0][10]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvTotalText" style="background-color:#DEFFFD"><%= sprintf("%8.1f", averages2[0][7]+averages2[0][8]+averages2[0][9]) + " (" + sprintf("%8.1f",cis2[0][8]+cis2[0][9]+cis2[0][10]) + ")" %></td>
							<% difference1 = averages2[0][7]+averages2[0][8]+averages2[0][9]-(averages1[0][7]+averages1[0][8]+averages1[0][9]) %>
							<% reduction1 = difference1 / (averages1[0][7]+averages1[0][8]+averages1[0][9]) * 100 %>
							<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
						<% end %>
						<% if @scenario3 > "0" && @scenario3 != "" then %>
							<td class="gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", averages3[0][7]+averages3[0][8]+averages3[0][9]) + " (" + sprintf("%8.1f",cis3[0][8]+cis3[0][9]+cis3[0][10]) + ")" %></td>
							<% difference1 = averages3[0][7]+averages3[0][8]+averages3[0][9]-(averages1[0][7]+averages1[0][8]+averages1[0][9]) %>
							<% reduction1 = difference1 / (averages1[0][7]+averages1[0][8]+averages1[0][9]) * 100 %>
							<td class= "gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1).to_s + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "41" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show9" class="gvTotalText"><%= "Surface Flow" + " (" + "in" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][7]) + " (" + sprintf("%8.1f", cis1[0][8]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][7]) + " (" + sprintf("%8.1f", cis2[0][8]) + ")" %></td>
							<td class=<%= if averages2[0][7]-averages1[0][7] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][7]-averages1[0][7]) + " (" + sprintf("%8.2f", ((averages2[0][7]-averages1[0][7]) / averages1[0][7]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][7]) + " (" + sprintf("%8.1f", cis3[0][8]) + ")" %></td>
							<td class=<%= if averages3[0][7]-averages1[0][7] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][7]-averages1[0][7]) + " (" + sprintf("%8.2f", ((averages3[0][7]-averages1[0][7]) / averages1[0][7]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "42" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show10" class="gvTotalText"><%= "Subsurface Flow" + " (" + "in" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][8]) + " (" + sprintf("%8.1f", cis1[0][9]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][8]) + " (" + sprintf("%8.1f", cis2[0][9]) + ")" %></td>
							<td class=<%= if averages2[0][8]-averages1[0][8] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][8]-averages1[0][8]) + " (" + sprintf("%8.2f", ((averages2[0][8]-averages1[0][8]) / averages1[0][8]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][8]) + " (" + sprintf("%8.1f", cis3[0][9]) + ")" %></td>
							<td class=<%= if averages3[0][8]-averages1[0][8] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][8]-averages1[0][8]) + " (" + sprintf("%8.2f", ((averages3[0][8]-averages1[0][8]) / averages1[0][8]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "43" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show11" class="gvTotalText"><%= "Tile Drain Flow" + " (" + "in" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][9]) + " (" + sprintf("%8.1f", cis1[0][10]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][9]) + " (" + sprintf("%8.1f", cis2[0][10]) + ")" %></td>
							<td class=<%= if averages2[0][9]-averages1[0][9] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][9]-averages1[0][9]) + " (" + sprintf("%8.2f", ((averages2[0][9]-averages1[0][9]) / averages1[0][9]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][9]) + " (" + sprintf("%8.1f", cis3[0][10]) + ")" %></td>
							<td class=<%= if averages3[0][9]-averages1[0][9] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][9]-averages1[0][9]) + " (" + sprintf("%8.2f", ((averages3[0][9]-averages1[0][9]) / averages1[0][9]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<%# Other Flow values %>
					<% row_id = t + "row" + "50" %>
					<tr class="gvRowStyleOdd", id = <%=row_id%>>
						<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
							<a class="gvTotalText"><%= "Total Other Water Info" + " (" + "in" + ")" %></a>
							<%= check_box_tag "Total P" %>
						</th>
						<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.1f", averages1[0][10]+averages1[0][11]).to_s + " (" + sprintf("%8.1f",cis1[0][11]+cis1[0][12]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvTotalText" style="background-color:#DEFFFD"><%= sprintf("%8.1f", averages2[0][10]+averages2[0][11]) + " (" + sprintf("%8.1f",cis2[0][11]+cis2[0][12]) + ")" %></td>
							<% difference1 = averages2[0][10]+averages2[0][11]-(averages1[0][10]+averages1[0][11]) %>
							<% reduction1 = difference1 / (averages1[0][10]+averages1[0][11]) * 100 %>
							<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
						<% end %>
						<% if @scenario3 > "0" && @scenario3 != "" then %>
							<td class="gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", averages3[0][10]+averages3[0][11]) + " (" + sprintf("%8.1f",cis3[0][11]+cis3[0][12]) + ")" %></td>
							<% difference1 = averages3[0][10]+averages3[0][11]-(averages1[0][10]+averages1[0][11]) %>
							<% reduction1 = difference1 / (averages1[0][10]+averages1[0][11]) * 100 %>
							<td class= "gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "51" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show12" class="gvTotalText"><%= "Irrigation Applied" + " (" + "in" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][10]).to_s + " (" + sprintf("%8.1f", cis1[0][11]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][10]) + " (" + sprintf("%8.1f", cis2[0][11]) + ")" %></td>
							<td class=<%= if averages2[0][10]-averages1[0][10] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][10]-averages1[0][10]) + " (" + sprintf("%8.2f", ((averages2[0][10]-averages1[0][10]) / averages1[0][10]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][10]) + " (" + sprintf("%8.1f", cis3[0][11]) + ")" %></td>
							<td class=<%= if averages3[0][10]-averages1[0][10] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][10]-averages1[0][10]) + " (" + sprintf("%8.2f", ((averages3[0][10]-averages1[0][10]) / averages1[0][10]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "52" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show13" class="gvTotalText"><%= "Deep Percolation" + " (" + "in" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][11]) + " (" + sprintf("%8.1f", cis1[0][12]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][11]) + " (" + sprintf("%8.1f",cis2[0][12]) + ")" %></td>
							<td class=<%= if averages2[0][11]-averages1[0][11] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][11]-averages1[0][11]) + " (" + sprintf("%8.2f", ((averages2[0][11]-averages1[0][11]) / averages1[0][11]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][11]) + " (" + sprintf("%8.1f", cis3[0][12]) + ")" %></td>
							<td class=<%= if averages3[0][11]-averages1[0][11] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][11]-averages1[0][11]) + " (" + sprintf("%8.2f", ((averages3[0][11]-averages1[0][11]) / averages1[0][11]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<%# Erosion %>
					<% row_id = t + "row" + "60" %>
					<tr class="gvRowStyleOdd", id = <%=row_id%>>
						<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
							<a class="gvTotalText"><%= "Total Sediment" + " (" + "t/ac" + ")" %></a>
							<%= check_box_tag "Total P" %>
						</th>
						<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.1f", averages1[0][12]+averages1[0][13]) + " (" + sprintf("%8.1f",cis1[0][13]+cis1[0][14]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvTotalText" style="background-color:#DEFFFD"><%= sprintf("%8.1f", averages2[0][12]+averages2[0][13]) + " (" + sprintf("%8.1f",cis2[0][13]+cis2[0][14]) + ")" %></td>
							<% difference1 = averages2[0][12]+averages2[0][13]-(averages1[0][12]+averages1[0][13]) %>
							<% reduction1 = difference1 / (averages1[0][12]+averages1[0][13]) * 100 %>
							<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
						<% end %>
						<% if @scenario3 > "0" && @scenario3 != "" then %>
							<td class="gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", averages3[0][12]+averages3[0][13]) + " (" + sprintf("%8.1f",cis3[0][13]+cis3[0][14]) + ")" %></td>
							<% difference1 = averages3[0][12]+averages3[0][13]-(averages1[0][12]+averages1[0][13]) %>
							<% reduction1 = difference1 / (averages1[0][12]+averages1[0][13]) * 100 %>
							<td class= "gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "61" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show14" class="gvTotalText"><%= "Surface Erosion" + " (" + "t/ac" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.4f", averages1[0][12]) + " (" + sprintf("%8.1f", cis1[0][13]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.4f", averages2[0][12]) + " (" + sprintf("%8.1f", cis2[0][13]) + ")" %></td>
							<td class=<%= if averages2[0][12]-averages1[0][12] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.4f", averages2[0][12]-averages1[0][12]) + " (" + sprintf("%8.2f", ((averages2[0][12]-averages1[0][12]) / averages1[0][12]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.4f", averages3[0][12]) + " (" + sprintf("%8.1f", cis3[0][13]) + ")" %></td>
							<td class=<%= if averages3[0][12]-averages1[0][12] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.4f", averages3[0][12]-averages1[0][12]) + " (" + sprintf("%8.2f", ((averages3[0][12]-averages1[0][12]) / averages1[0][12]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<% row_id = t + "row" + "62" %>
					<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
						<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><a id="show15" class="gvTotalText"><%= "Manure Erosion" + " (" + "t/ac" + ")" %></a></th>
						<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.4f", averages1[0][13]) + " (" + sprintf("%8.1f", cis1[0][14]) + ")" %></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.4f", averages2[0][13]) + " (" + sprintf("%8.1f", cis2[0][14]) + ")" %></td>
							<td class=<%= if averages2[0][13]-averages1[0][13] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.4f", averages2[0][13]-averages1[0][13]) + " (" + sprintf("%8.2f", ((averages2[0][13]-averages1[0][13]) / averages1[0][13]) * 100) + ")" %></td>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then %>
							<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.4f", averages3[0][13]) + " (" + sprintf("%8.1f", cis3[0][14]) + ")" %></td>
							<td class=<%= if averages3[0][13]-averages1[0][13] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.4f", averages3[0][13]-averages1[0][13]) + " (" + sprintf("%8.2f", ((averages3[0][13]-averages1[0][13]) / averages1[0][13]) * 100) + ")" %></td>
						<% end %>
					</tr>
					<%# Crops %>
					<% row_id = t + "row" + "70" %>
					<tr class="gvRowStyleOdd", id = <%=row_id%>>
						<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
							<a id="show16" class="gvTotalText"><%= "Crop Yield"  %></a>
							<%= check_box_tag "Crop Yield" %>
						</th>
						<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"></td>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<td class="gvTotalText" style="background-color:#DEFFFD"></td>
							<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"></td>
						<% end %>
						<% if @scenario3 > "0" then %>
							<td class="gvTotalText" style="background-color:#CADCFF"></td>
							<td class= "gvTotalText" style="background-color:#CADCFF"></td>
						<% end %>
					</tr>
					<%# Determine the number of crops to list them and the stress values %>
					<% i = 1 %>
					<% crop_results = Array.new %>
					<% crops1.each do |cr1| %>
						<% crop_result = Hash.new %>
						<% crop_result["name"] = cr1[5] %>
						<% crop_result["yield1"] = cr1[0] %>
						<% crop_result["ci1"] = cic1.assoc(cr1[5])[1] %>
						<% crop_result["ws1"] = cr1[1].round(0) %>
						<% crop_result["ns1"] = cr1[2].round(0) %>
						<% crop_result["ps1"] = cr1[3].round(0) %>
						<% crop_result["ts1"] = cr1[4].round(0) %>
						<% crop_result["yield2"] = 0 %>
						<% crop_result["ci2"] = 0 %>
						<% crop_result["ws2"] = 0 %>
						<% crop_result["ns2"] = 0 %>
						<% crop_result["ps2"] = 0 %>
						<% crop_result["ts2"] = 0 %>
						<% crop_result["yield3"] = 0 %>
						<% crop_result["ci3"] = 0 %>
						<% crop_result["ws3"] = 0 %>
						<% crop_result["ns3"] = 0 %>
						<% crop_result["ps3"] = 0 %>
						<% crop_result["ts3"] = 0 %>
						<% if @scenario2 != "0" && @scenario2 != "" then%>
							<% crops2.each do |cr2| %>
								<% if cr2[5] == cr1[5] then %>
									<% crop_result["yield2"] = cr2[0] %>
									<% crop_result["ci2"] = cic2.assoc(cr2[5])[1] %>
									<% crop_result["ws2"] = cr2[1].round(0) %>
									<% crop_result["ns2"] = cr2[2].round(0) %>
									<% crop_result["ps2"] = cr2[3].round(0) %>
									<% crop_result["ts2"] = cr2[4].round(0) %>
								<% end %>
							<% end %>
						<% end %>
						<% if @scenario3 != "0" && @scenario3 != "" then%>
							<% crops3.each do |cr3| %>
								<% if cr3[5] == cr1[5] then %>
									<% crop_result["yield3"] = cr3[0] %>
									<% crop_result["ci3"] = cic3.assoc(cr3[5])[1] %>
									<% crop_result["ws3"] = cr3[1].round(0) %>
									<% crop_result["ns3"] = cr3[2].round(0) %>
									<% crop_result["ps3"] = cr3[3].round(0) %>
									<% crop_result["ts3"] = cr3[4].round(0) %>
								<% end %>
							<% end %>
						<% end %>
						<% crop_results.push(crop_result) %>
					<% end %>
					<%# will find out if there are new crops in scenario 2 %>
					<% if @scenario2 != "0" && @scenario2 != "" then %>
						<% crops2.each do |cr2| %>
							<% found = false %>
							<% crops1.each do |cr1|%>
								<% if cr2[5] == cr1[5] then %>
									<% found = true %>
									<% break %>
								<% end %>
							<% end %>
							<% if found == false then %>   <%# this is a new crop and needs to be added to the list %>
								<% crop_result = Hash.new %>
								<% crop_result["name"] = cr2[5] %>
								<% crop_result["yield1"] = 0 %>
								<% crop_result["ci1"] = 0 %>
								<% crop_result["ws1"] = 0 %>
								<% crop_result["ns1"] = 0 %>
								<% crop_result["ps1"] = 0 %>
								<% crop_result["ts1"] = 0 %>
								<% crop_result["yield2"] = cr2[0] %>
								<% crop_result["ci2"] = cic2.assoc(cr2[5])[1] %>
								<% crop_result["ws2"] = cr2[1] %>
								<% crop_result["ns2"] = cr2[2] %>
								<% crop_result["ps2"] = cr2[3] %>
								<% crop_result["ts2"] = cr2[4] %>
								<% crop_result["yield3"] = 0 %>
								<% crop_result["ci3"] = 0 %>
								<% crop_result["ws3"] = 0 %>
								<% crop_result["ns3"] = 0 %>
								<% crop_result["ps3"] = 0 %>
								<% crop_result["ts3"] = 0 %>
								<% if @scenario3 != "0" && @scenario3 != "" then %>
									<% crops3.each do |cr3| %>
										<% if cr3[5] == cr2[5] then %>
											<% crop_result["yield3"] = cr3[0] %>
											<% crop_result["ci3"] = cic3.assoc(cr3[5])[1] %>
											<% crop_result["ws3"] = cr3[1] %>
											<% crop_result["ns3"] = cr3[2] %>
											<% crop_result["ps3"] = cr3[3] %>
											<% crop_result["ts3"] = cr3[4] %>
										<% end %>
									<% end %>
								<% end %>
								<% crop_results.push(crop_result) %>
							<% end %>
						<% end %>
					<% end %>
					<%# will find out if there are new crops in scenario 3 %>
					<% if @scenario3 != "0" && @scenario3 != "" then %>
						<% crops3.each do |cr3| %>
							<% found = false %>
							<% crop_results.each do |cr|%>
								<% if cr3[5] == cr["name"] then %>
									<% found = true %>
									<% break %>
								<% end %>
							<% end %>
							<% if found == false then %>   <%# this is a new crop and needs to be added to the list %>
								<% crop_result = Hash.new %>
								<% crop_result["name"] = cr3[5] %>
								<% crop_result["yield1"] = 0 %>
								<% crop_result["ci1"] = 0 %>
								<% crop_result["ws1"] = 0 %>
								<% crop_result["ns1"] = 0 %>
								<% crop_result["ps1"] = 0 %>
								<% crop_result["ts1"] = 0 %>
								<% crop_result["yield2"] = 0 %>
								<% crop_result["ci2"] = 0 %>
								<% crop_result["ws2"] = 0 %>
								<% crop_result["ns2"] = 0 %>
								<% crop_result["ps2"] = 0 %>
								<% crop_result["ts2"] = 0 %>
								<% crop_result["yield3"] = cr3[0] %>
								<% crop_result["ci3"] = cic3.assoc(cr3[5])[1] %>
								<% crop_result["ws3"] = cr3[1] %>
								<% crop_result["ns3"] = cr3[2] %>
								<% crop_result["ps3"] = cr3[3] %>
								<% crop_result["ts3"] = cr3[4] %>
								<% crop_results.push(crop_result) %>
							<% end %>
						<% end %>
					<% end %>
					<% crop_results.each do |cr| %>
						<%# get conversion unit dry matter to calculate yield and also take the unts %>
						<% crop = Crop.find_by_code(cr["name"]) %>
					    <% conversion_factor = 1 * AC_TO_HA %>
					    <% dry_matter = 100 %>
					    <% unit = "t/ac" %>
						<% if crop != nil then %>
					      <% conversion_factor = crop.conversion_factor * AC_TO_HA %>
					      <% dry_matter = crop.dry_matter %>
					      <% unit = crop.yield_unit + "/ac" %>
					      <%# cr["ci1"] = cr["ci1"] * conversion_factor / (dry_matter/100)%>
						<% end %>
						<% row_id = t + "row" + (70 + i).to_s %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= crop.name + " (" + unit + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.0f", cr["yield1"] * conversion_factor / (dry_matter/100)) + " (" + sprintf("%8.1f", cr["ci1"]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.0f", cr["yield2"] * conversion_factor / (dry_matter/100)) + " (" + sprintf("%8.1f", cr["ci2"]) + ")" %></td>
								<td class=<%= if cr["yield2"]-cr["yield1"] <= 0 then "nutrients_negative bottom_border" else "nutrients_positive bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.0f", (cr["yield2"]-cr["yield1"])* conversion_factor / (dry_matter/100)) + " (" + sprintf("%8.1f", (cr["yield2"]-cr["yield1"]) * 100 / cr["yield1"]) + ")" unless cr["yield1"]==0 %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.0f", cr["yield3"] * conversion_factor / (dry_matter/100)) + " (" + sprintf("%8.1f", cr["ci3"]) + ")" %></td>
								<td class=<%= if cr["yield3"]-cr["yield1"] <= 0 then "nutrients_negative bottom_border" else "nutrients_positive bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.0f", (cr["yield3"]-cr["yield1"])* conversion_factor / (dry_matter/100)) + " (" + sprintf("%8.1f", (cr["yield3"]-cr["yield1"])*100 / cr["yield1"]) + ")" unless cr["yield1"]==0 %></td>
							<% end %>
						</tr>
						<% i += 1 %>
					<% end %>
					<% if ENV["APP_VERSION"] == "standard" %>
						<% row_id = t + "row" + "200" %>
						<tr class="gvRowStyleOdd", id = <%=row_id%>>
							<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
								<a id="show17" class="gvTotalText"><%= "N Stress"  %></a>
								<%= check_box_tag "N Stress" %>
							</th>
							<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvTotalText" style="background-color:#DEFFFD"></td>
								<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"></td>
							<% end %>
							<% if @scenario3 > "0" then %>
								<td class="gvTotalText" style="background-color:#CADCFF"></td>
								<td class= "gvTotalText" style="background-color:#CADCFF"></td>
							<% end %>
						</tr>
            <% i = 1 %>
						<% crop_results.each do |cr| %>
							<%# get conversion unit dry matter to calculate yield and also take the unts %>
							<% crop = Crop.find_by_code(cr["name"]) %>
							<%# if crop != nil then %>
							<%# end %>
							<% row_id = t + "row" + (200 + i).to_s %>
							<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
								<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= crop.name + " (" + "days" + ")" %></th>
								<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.0f", cr["ns1"]) + " (" + sprintf("%8.1f", cr["ns1"]*100.0/crop.dyam) + "%)" %></td>
								<% if @scenario2 != "0" && @scenario2 != "" then %>
									<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.0f", cr["ns2"]) + " (" + sprintf("%8.1f", (cr["ns2"] * 100.0 / crop.dyam).round(1)) + "%)" %></td>
									<td class=<%= if cr["ns2"]-cr["ns1"] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.0f", cr["ns2"]-cr["ns1"]) + " (" + sprintf("%8.1f", (cr["ns2"]-cr["ns1"])*100 / cr["ns1"]) + ")" unless cr["ns1"]==0 %></td>
								<% end %>
								<% if @scenario3 != "0" && @scenario3 != "" then %>
									<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.0f", cr["ns3"]) + " (" + sprintf("%8.1f", cr["ns3"] * 100.0 / crop.dyam.round(1)) + "%)" %></td>
									<td class=<%= if cr["ns3"]-cr["ns1"] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.0f", cr["ns3"]-cr["ns1"]) + " (" + sprintf("%8.1f", (cr["ns3"]-cr["ns1"]) * 100 / cr["ns1"]) + ")" unless cr["ns1"]==0 %></td>
								<% end %>
							</tr>
							<% i += 1 %>
						<% end %>
						<% row_id = t + "row" + "210" %>
						<tr class="gvRowStyleOdd", id = <%=row_id%>>
							<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
								<a id="show18" class="gvTotalText"><%= "P Stress"  %></a>
								<%= check_box_tag "P Stress" %>
							</th>
							<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvTotalText" style="background-color:#DEFFFD"></td>
								<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"></td>
							<% end %>
							<% if @scenario3 > "0" then %>
								<td class="gvTotalText" style="background-color:#CADCFF"></td>
								<td class= "gvTotalText" style="background-color:#CADCFF"></td>
							<% end %>
						</tr>
            <% i = 1 %>
						<% crop_results.each do |cr| %>
							<%# get conversion unit dry matter to calculate yield and also take the unts %>
							<% crop = Crop.find_by_code(cr["name"]) %>
							<%# if crop != nil then %>
							<%# end %>
							<% row_id = t + "row" + (210 + i).to_s %>
							<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
								<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= crop.name + " (" + "days" + ")" %></th>
								<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.0f", cr["ps1"]) + " (" + sprintf("%8.1f", cr["ps1"]*100.0/crop.dyam) + "%)" %></td>
								<% if @scenario2 != "0" && @scenario2 != "" then %>
									<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.0f", cr["ps2"]) + " (" + sprintf("%8.1f", (cr["ps2"] * 100.0 / crop.dyam).round(1)) + "%)" %></td>
									<td class=<%= if cr["ps2"]-cr["ns1"] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", cr["ps2"]-cr["ps1"]) + " (" + sprintf("%8.2f", (cr["ps2"]-cr["ps1"]) *100/ cr["ps1"]) + ")" unless cr["ps1"]==0 %></td>
								<% end %>
								<% if @scenario3 != "0" && @scenario3 != "" then %>
									<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.0f", cr["ps3"]) + " (" + sprintf("%8.1f", cr["ps3"] * 100.0 / crop.dyam.round(1)) + "%)" %></td>
									<td class=<%= if cr["ps3"]-cr["ps1"] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", cr["ps3"]-cr["ps1"]) + " (" + sprintf("%8.2f", (cr["ps3"]-cr["ps1"]) *100/ cr["ps1"]) + ")" unless cr["ps1"]==0 %></td>
								<% end %>
							</tr>
							<% i += 1 %>
						<% end %>
						<% row_id = t + "row" + "220" %>
						<tr class="gvRowStyleOdd", id = <%=row_id%>>
							<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
								<a id="show19" class="gvTotalText"><%= "Temperature Stress"  %></a>
								<%= check_box_tag "Temperature Stress" %>
							</th>
							<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvTotalText" style="background-color:#DEFFFD"></td>
								<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"></td>
							<% end %>
							<% if @scenario3 > "0" then %>
								<td class="gvTotalText" style="background-color:#CADCFF"></td>
								<td class= "gvTotalText" style="background-color:#CADCFF"></td>
							<% end %>
						</tr>
            <% i = 1 %>
						<% crop_results.each do |cr| %>
							<%# get conversion unit dry matter to calculate yield and also take the unts %>
							<% crop = Crop.find_by_code(cr["name"]) %>
							<%# if crop != nil then %>
							<%# end %>
							<% row_id = t + "row" + (220 + i).to_s %>
							<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
								<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= crop.name + " (" + "days" + ")" %></th>
								<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.0f", cr["ts1"]) + " (" + sprintf("%8.1f", cr["ts1"]*100.0/crop.dyam) + "%)" %></td>
								<% if @scenario2 != "0" && @scenario2 != "" then %>
									<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.0f", cr["ts2"]) + " (" + sprintf("%8.1f", (cr["ts2"] * 100.0 / crop.dyam).round(1)) + "%)" %></td>
									<td class=<%= if cr["ts2"]-cr["ts1"] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", cr["ts2"]-cr["ts1"]) + " (" + sprintf("%8.2f", (cr["ts2"]-cr["ts1"]) * 100 / cr["ts1"]) + ")" unless cr["ts1"]==0 %></td>
								<% end %>
								<% if @scenario3 != "0" && @scenario3 != "" then %>
									<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.0f", cr["ts3"]) + " (" + sprintf("%8.1f", cr["ts3"] * 100.0 / crop.dyam.round(1)) + "%)" %></td>
									<td class=<%= if cr["ts3"]-cr["ts1"] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", cr["ts3"]-cr["ts1"]) + " (" + sprintf("%8.2f", (cr["ts3"]-cr["ts1"]) * 100 / cr["ts1"]) + ")" unless cr["ts1"]==0 %></td>
								<% end %>
							</tr>
							<% i += 1 %>
						<% end %>
						<% row_id = t + "row" + "230" %>
						<tr class="gvRowStyleOdd", id = <%=row_id%>>
							<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
								<a id="show20" class="gvTotalText"><%= "Water Stress"  %></a>
								<%= check_box_tag "Water Stress" %>
							</th>
							<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvTotalText" style="background-color:#DEFFFD"></td>
								<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"></td>
							<% end %>
							<% if @scenario3 > "0" then %>
								<td class="gvTotalText" style="background-color:#CADCFF"></td>
								<td class= "gvTotalText" style="background-color:#CADCFF"></td>
							<% end %>
						</tr>
            <% i = 1 %>
						<% crop_results.each do |cr| %>
							<%# get conversion unit dry matter to calculate yield and also take the unts %>
							<% crop = Crop.find_by_code(cr["name"]) %>
							<% if crop != nil then %>
							<% end %>
							<% row_id = t + "row" + (230 + i).to_s %>
							<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
								<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= crop.name + " (" + "days" + ")" %></th>
								<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.0f", cr["ws1"]) + " (" + sprintf("%8.1f", cr["ws1"]*100.0/crop.dyam) + "%)" %></td>
								<% if @scenario2 != "0" && @scenario2 != "" then %>
									<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.0f", cr["ws2"]) + " (" + sprintf("%8.1f", (cr["ws2"] * 100.0 / crop.dyam).round(1)) + "%)" %></td>
									<td class=<%= if cr["ws2"]-cr["ws1"] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", cr["ws2"]-cr["ws1"]) + " (" + sprintf("%8.2f", (cr["ws2"]-cr["ws1"]) *100/ cr["ws1"]) + ")" unless cr["ws1"]==0 %></td>
								<% end %>
								<% if @scenario3 != "0" && @scenario3 != "" then %>
									<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.0f", cr["ws3"]) + " (" + sprintf("%8.1f", cr["ws3"] * 100.0 / crop.dyam.round(1)) + "%)" %></td>
									<td class=<%= if cr["ns3"]-cr["ws1"] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", cr["ws3"]-cr["ws1"]) + " (" + sprintf("%8.2f", (cr["ws3"]-cr["ws1"]) *100/ cr["ws1"]) + ")" unless cr["ws1"]==0 %></td>
								<% end %>
							</tr>
							<% i += 1 %>
						<% end %>
					<% end %>
				<% end %>
				<!--Crop result here -->
				<% id = 70%>
			</tbody>
		</table>
	  </div>
	</div>

	<div id="tbl_total" class="table-responsive" style="display: none">
	  <div class="panel panel-default">
		<table class='table table-bordered', style="white-space: nowrap;">
		  	<thead> <!-- titles -->
			  	<tr class='gvHeaderStyle' >
			  		<th></th>
			  		<% if session[:simulation] == 'scenario' %>
						<% if @scenario1 == "0" || @scenario1 == "" %> <th style="text-align:center"><%= t('result.scenario1') %></th> <% else %> <th style="text-align:center"><%=Scenario.find(@scenario1).name%></th><%end%>
						<% if @scenario2 == "0" || @scenario2 == ""  %> <th colspan="2" style="text-align:center"><%= t('result.scenario2') %></th> <% else %> <th colspan="2" style="text-align:center"><%=Scenario.find(@scenario2).name%></th><%end%>
						<% if @scenario3 == "0" || @scenario3 == ""  %> <th colspan="2" style="text-align:center"><%= t('result.scenario3') %></th> <% else %> <th colspan="2" style="text-align:center"><%=Scenario.find(@scenario3).name%></th><%end%>
					<% else %>
						<% if @scenario1 == "0" || @scenario1 == ""  %> <th style="text-align:center"><%= t('result.scenario1') %></th> <% else %> <th style="text-align:center"><%=Watershed.find(@scenario1).name%></th><%end%>
						<% if @scenario2 == "0" || @scenario2 == ""  %> <th colspan="2" style="text-align:center"><%= t('result.scenario1') %></th> <% else %> <th colspan="2" style="text-align:center"><%=Watershed.find(@scenario2).name%></th><%end%>
						<% if @scenario3 == "0" || @scenario3 == ""  %> <th colspan="2" style="text-align:center"><%= t('result.scenario3') %></th> <% else %> <th colspan="2" style="text-align:center"><%=Watershed.find(@scenario3).name%></th><%end%>
					<% end %>
			  	</tr>
				<tr class='gvHeaderStyle'>
					<th style="border-right: thick double #ff0000" ><%= t('result.description') %></th>
					<th ><%= "Losses(±)" %></th>
					<th ><%= "Losses(±)" %></th>
					<th style="border-right: thick double #ff0000"><%= t('general.change') + "(%)"%></th>
					<th ><%= "Losses(±)" %></th>
					<th ><%= t('general.change') + "(%)"%></th>
				</tr>
		  	</thead>
		  	<tbody>
		  		<% t = "t" %>
			    <%# if @results1 != nil && @present %>
				<%# else %>
					<% total_area = 0 %>
					<% row_id = t + "row" + "20" %>
					<% if @scenario1 != "0" then %>
						<% if session[:simulation] == "scenario" %>
							<% total_area = @total_area1 %>
						<% else %>
							<%# watershed = Watershed.find(@scenario1) %>
							<% total_area = @total_area1 %>
							<%# watershed.watershed_scenarios.each do |ws| %>
								<%# total_area += ws.field.field_area %>
							<%# end %>
						<% end %>
						<% averages1 = AnnualResult.where(:sub1 => 0, :"#{@id}" => @scenario1).pluck('avg(orgn)*' + total_area.to_s, 'avg(qn)*' + total_area.to_s, 'avg(no3-qn)*' + total_area.to_s, 'avg(qdrn)*' + total_area.to_s, 'avg(orgp)*' + total_area.to_s, 'avg(po4)*' + total_area.to_s, 'avg(qdrp)*' + total_area.to_s, 'avg(surface_flow)*' + total_area.to_s, 'avg(flow-surface_flow)*' + total_area.to_s, 'avg(qdr)*' + total_area.to_s, 'avg(irri)*' + total_area.to_s, 'avg(dprk)*' + total_area.to_s, 'avg(sed)*' + total_area.to_s, 'avg(ymnu)*' + total_area.to_s) %>
						<% crops1 = CropResult.where(@id + " = ? AND (yldg + yldf) > ?", @scenario1, 0).order("name").group(:name).pluck('avg(yldg)*' + total_area.to_s + "-" +  'avg(yldf)*' + total_area.to_s, 'avg(ws)', 'avg(ns)', 'avg(ps)', 'avg(ts)', 'name')%>
						<% averages2 = "0" %>
						<% if @scenario2 != "0" && @scenario2 != "" then %>
							<% total_area = @total_area2 %>
							<% averages2 = AnnualResult.where(:sub1 => 0, :"#{@id}"=> @scenario2).pluck('avg(orgn)*' + total_area.to_s, 'avg(qn)*' + total_area.to_s, 'avg(no3-qn)*' + total_area.to_s, 'avg(qdrn)*' + total_area.to_s, 'avg(orgp)*' + total_area.to_s, 'avg(po4)*' + total_area.to_s, 'avg(qdrp)*' + total_area.to_s, 'avg(surface_flow)*' + total_area.to_s, 'avg(flow-surface_flow)*' + total_area.to_s, 'avg(qdr)*' + total_area.to_s, 'avg(irri)*' + total_area.to_s, 'avg(dprk)*' + total_area.to_s, 'avg(sed)*' + total_area.to_s, 'avg(ymnu)*' + total_area.to_s) %>
							<% crops2 = CropResult.where(@id + " = ? AND (yldg + yldf) > ?", @scenario2, 0).order("name").group(:name).pluck('avg(yldg)*' + total_area.to_s + "-" +  'avg(yldf)*' + total_area.to_s, 'avg(ws)', 'avg(ns)', 'avg(ps)', 'avg(ts)', 'name')%>
							<% if @scenario3 != "0" && @scenario3 != ""  then %>
								<% total_area = @total_area3 %>
								<% averages3 = AnnualResult.where(:sub1 => 0, :"#{@id}" => @scenario3).pluck('avg(orgn)*' + total_area.to_s, 'avg(qn)*' + total_area.to_s, 'avg(no3-qn)*' + total_area.to_s, 'avg(qdrn)*' + total_area.to_s, 'avg(orgp)*' + total_area.to_s, 'avg(po4)*' + total_area.to_s, 'avg(qdrp)*' + total_area.to_s, 'avg(surface_flow)*' + total_area.to_s, 'avg(flow-surface_flow)*' + total_area.to_s, 'avg(qdr)*' + total_area.to_s, 'avg(irri)*' + total_area.to_s, 'avg(dprk)*' + total_area.to_s, 'avg(sed)*' + total_area.to_s, 'avg(ymnu)*' + total_area.to_s) %>
						<% crops3 = CropResult.where(@id + " = ? AND (yldg + yldf) > ?", @scenario3, 0).order("name").group(:name).pluck('avg(yldg)*' + total_area.to_s + "-" +  'avg(yldf)*' + total_area.to_s, 'avg(ws)', 'avg(ns)', 'avg(ps)', 'avg(ts)', 'name')%>
							<% end %>
						<% end %>
						<tr class="gvRowStyleOdd", id = <%=row_id%>>
							<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
								<%= "Total N" + " (" + "lbs/ac" + ")" %>
								<%= check_box_tag "Total N" %>
							</th>
							<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.1f", averages1[0][0]+averages1[0][1]+averages1[0][2]+averages1[0][3]) + " (" + sprintf("%8.1f", cis1[0][1]+cis1[0][2]+cis1[0][3]+cis1[0][4]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvTotalText" style="background-color:#DEFFFD"><%= sprintf("%8.1f", averages2[0][0]+averages2[0][1]+averages2[0][2]+averages2[0][3]) + " (" + sprintf("%8.1f", cis2[0][1]+cis2[0][2]+cis2[0][3]+cis2[0][4]) + ")" %></td>
								<% difference1 = averages2[0][0]+averages2[0][1]+averages2[0][2]+averages2[0][3]-(averages1[0][0]+averages1[0][1]+averages1[0][2]+averages1[0][3]) %>
								<% reduction1 = difference1 / (averages1[0][0]+averages1[0][1]+averages1[0][2]+averages1[0][3]) * 100 %>
								<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
							<% end %>
							<% if @scenario3 > "0" then %>
								<td class="gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", averages3[0][0]+averages3[0][1]+averages3[0][2]+averages3[0][3]).to_s + " (" + sprintf("%8.1f", cis3[0][1]+cis3[0][2]+cis3[0][3]+cis3[0][4]) + ")" %></td>
								<% difference1 = averages3[0][0]+averages3[0][1]+averages3[0][2]+averages3[0][3]-(averages1[0][0]+averages1[0][1]+averages1[0][2]+averages1[0][3]) %>
								<% reduction1 = difference1 / (averages1[0][0]+averages1[0][1]+averages1[0][2]+averages1[0][3]) * 100 %>
								<td class= "gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", difference1).to_s + " (" + sprintf("%8.1f", reduction1).to_s + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "21" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Org N" + " (" + "lbs/ac" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][0]) + " (" + sprintf("%8.1f", cis1[0][1]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][0]) + " (" + sprintf("%8.1f", cis2[0][1]) + ")" %></td>
								<td class=<%= if averages2[0][0]-averages1[0][0] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][0]-averages1[0][0]) + " (" + sprintf("%8.2f", ((averages2[0][0]-averages1[0][0]) / averages1[0][0]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][0]) + " (" + sprintf("%8.1f", cis3[0][1]) + ")" %></td>
								<td class=<%= if averages3[0][0]-averages1[0][0] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][0]-averages1[0][0]) + " (" + sprintf("%8.2f", ((averages3[0][0]-averages1[0][0]) / averages1[0][0]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "22" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Runoff N" + " (" + "lbs/ac" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][1]) + " (" + sprintf("%8.1f", cis1[0][2]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][1]) + " (" + sprintf("%8.1f", cis2[0][2]) + ")" %></td>
								<td class=<%= if averages2[0][1]-averages1[0][1] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][1]-averages1[0][1]) + " (" + sprintf("%8.2f", ((averages2[0][1]-averages1[0][1]) / averages1[0][1]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][1]) + " (" + sprintf("%8.1f", cis3[0][2]) + ")" %></td>
								<td class=<%= if averages3[0][1]-averages1[0][1] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][1]-averages1[0][1]) + " (" + sprintf("%8.2f", ((averages3[0][1]-averages1[0][1]) / averages1[0][1]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "23" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Subsurface N" + " (" + "lbs/ac" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][2]).to_s + " (" + sprintf("%8.1f", cis1[0][3]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][2]) + " (" + sprintf("%8.1f", cis2[0][3]) + ")" %></td>
								<td class=<%= if averages2[0][2]-averages1[0][2] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][2]-averages1[0][2]).to_s + " (" + sprintf("%8.2f", ((averages2[0][2]-averages1[0][2]) / averages1[0][2]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][2]) + " (" + sprintf("%8.1f", cis3[0][3]) + ")" %></td>
								<td class=<%= if averages3[0][2]-averages1[0][2] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][2]-averages1[0][2]) + " (" + sprintf("%8.2f", ((averages3[0][2]-averages1[0][2]) / averages1[0][2]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "24" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Tile Drain N" + " (" + "lbs/ac" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][3]).to_s + " (" + sprintf("%8.1f", cis1[0][4]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][3]-averages1[0][3]) + " (" + sprintf("%8.1f", cis2[0][4]) + ")" %></td>
								<td class=<%= if averages2[0][3]-averages1[0][3] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][3]-averages1[0][3]).to_s + " (" + sprintf("%8.1f", ((averages2[0][3]-averages1[0][3]) / averages1[0][3]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][3]-averages1[0][3]).to_s + " (" + sprintf("%8.1f", cis3[0][4]) + ")" %></td>
								<td class=<%= if averages3[0][3]-averages1[0][3] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][3]-averages1[0][3]).to_s + " (" + sprintf("%8.1f", ((averages3[0][3]-averages1[0][3]) / averages1[0][3]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<%# P values %>
						<% row_id = t + "row" + "30" %>
						<tr class="gvRowStyleOdd", id = <%=row_id%>>
							<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
								<%= "Total P" + " (" + "lbs/ac" + ")" %>
								<%= check_box_tag "Total P" %>
							</th>
							<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.1f", averages1[0][4]+averages1[0][5]+averages1[0][6]).to_s + " (" + sprintf("%8.1f", cis1[0][5]+cis1[0][6]+cis1[0][7]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvTotalText" style="background-color:#DEFFFD"><%= sprintf("%8.1f", averages2[0][4]+averages2[0][5]+averages2[0][6]) + " (" + sprintf("%8.1f", cis2[0][5]+cis2[0][6]+cis2[0][7]) + ")" %></td>
								<% difference1 = averages2[0][4]+averages2[0][5]+averages2[0][6]-(averages1[0][4]+averages1[0][5]+averages1[0][6]) %>
								<% reduction1 = difference1 / (averages1[0][4]+averages1[0][5]+averages1[0][6]) * 100 %>
								<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
							<% end %>
							<% if @scenario3 > "0" then %>
								<td class="gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", averages3[0][4]+averages3[0][5]+averages3[0][6]) + " (" + sprintf("%8.1f", cis3[0][5]+cis3[0][6]+cis3[0][7]) + ")" %></td>
								<% difference1 = averages3[0][4]+averages3[0][5]+averages3[0][6]-(averages1[0][4]+averages1[0][5]+averages1[0][6]) %>
								<% reduction1 = difference1 / (averages1[0][4]+averages1[0][5]+averages1[0][5]) * 100 %>
								<td class= "gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", difference1).to_s + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "31" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Org P" + " (" + "lbs/ac" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][4]) + " (" + sprintf("%8.1f", cis1[0][5]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][4]) + " (" + sprintf("%8.1f", cis2[0][5]) + ")" %></td>
								<td class=<%= if averages2[0][4]-averages1[0][4] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][4]-averages1[0][4]).to_s + " (" + sprintf("%8.2f", ((averages2[0][4]-averages1[0][4]) / averages1[0][4]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][4]) + " (" + sprintf("%8.1f", cis3[0][5]) + ")" %></td>
								<td class=<%= if averages3[0][4]-averages1[0][4] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][4]-averages1[0][4]).to_s + " (" + sprintf("%8.2f", ((averages3[0][4]-averages1[0][4]) / averages1[0][4]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "32" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "PO4" + " (" + "lbs/ac" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][5]) + " (" + sprintf("%8.1f", cis1[0][6]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][5]) + " (" + sprintf("%8.1f", cis2[0][6]) + ")" %></td>
								<td class=<%= if averages2[0][5]-averages1[0][5] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][5]-averages1[0][5]) + " (" + sprintf("%8.2f", ((averages2[0][5]-averages1[0][5]) / averages1[0][5]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages2[0][5]) + " (" + sprintf("%8.1f", cis3[0][6]) + ")" %></td>
								<td class=<%= if averages3[0][5]-averages1[0][5] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][5]-averages1[0][5]) + " (" + sprintf("%8.2f", ((averages3[0][5]-averages1[0][5]) / averages1[0][5]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "33" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Tile Drain P" + " (" + "lbs/ac" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][6]) + " (" + sprintf("%8.1f", cis1[0][7]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][6]) + " (" + sprintf("%8.1f", cis2[0][7]) + ")" %></td>
								<td class=<%= if averages2[0][6]-averages1[0][6] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][6]-averages1[0][6]) + " (" + sprintf("%8.2f", ((averages2[0][6]-averages1[0][6]) / averages1[0][6]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][6]) + " (" + sprintf("%8.1f", cis3[0][7]) + ")" %></td>
								<td class=<%= if averages3[0][6]-averages1[0][6] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][6]-averages1[0][6]).to_s + " (" + sprintf("%8.2f", ((averages3[0][6]-averages1[0][6]) / averages1[0][6]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<%# Flow values %>
						<% row_id = t + "row" + "40" %>
						<tr class="gvRowStyleOdd", id = <%=row_id%>>
							<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
								<%= "Surface/Subsurface/Tile Drain Flow" + " (" + "in" + ")" %>
								<%= check_box_tag "Total P" %>
							</th>
							<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.1f", averages1[0][7]+averages1[0][8]+averages1[0][9]) + " (" + sprintf("%8.1f", cis1[0][8]+cis1[0][9]+cis1[0][10]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvTotalText" style="background-color:#DEFFFD"><%= sprintf("%8.1f", averages2[0][7]+averages2[0][8]+averages2[0][9]) + " (" + sprintf("%8.1f", cis2[0][8]+cis2[0][9]+cis2[0][10]) + ")" %></td>
								<% difference1 = averages2[0][7]+averages2[0][8]+averages2[0][9]-(averages1[0][7]+averages1[0][8]+averages1[0][9]) %>
								<% reduction1 = difference1 / (averages1[0][7]+averages1[0][8]+averages1[0][9]) * 100 %>
								<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1).to_s + ")" %></td>
							<% end %>
							<% if @scenario3 > "0" then %>
								<td class="gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", averages3[0][7]+averages3[0][8]+averages3[0][9]) + " (" + sprintf("%8.1f", cis3[0][8]+cis3[0][9]+cis3[0][10]) + ")" %></td>
								<% difference1 = averages3[0][7]+averages3[0][8]+averages3[0][9]-(averages1[0][7]+averages1[0][8]+averages1[0][9]) %>
								<% reduction1 = difference1 / (averages1[0][7]+averages1[0][8]+averages1[0][9]) * 100 %>
								<td class= "gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", difference1).to_s + " (" + sprintf("%8.1f", reduction1).to_s + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "41" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Surface Flow" + " (" + "in" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][7]) + " (" + sprintf("%8.1f", cis1[0][8]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][7]) + " (" + sprintf("%8.1f", cis2[0][8]) + ")" %></td>
								<td class=<%= if averages2[0][7]-averages1[0][7] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][7]-averages1[0][7]) + " (" + sprintf("%8.2f", ((averages2[0][7]-averages1[0][7]) / averages1[0][7]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][7]) + " (" + sprintf("%8.1f", cis3[0][8]) + ")" %></td>
								<td class=<%= if averages3[0][7]-averages1[0][7] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][7]-averages1[0][7]).to_s + " (" + sprintf("%8.2f", ((averages3[0][7]-averages1[0][7]) / averages1[0][7]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "42" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Subsurface Flow" + " (" + "in" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][8]) + " (" + sprintf("%8.1f", cis1[0][9]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][8]) + " (" + sprintf("%8.1f", cis2[0][9]) + ")" %></td>
								<td class=<%= if averages2[0][8]-averages1[0][8] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][8]-averages1[0][8]) + " (" + sprintf("%8.2f", ((averages2[0][8]-averages1[0][8]) / averages1[0][8]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][8]) + " (" + sprintf("%8.1f", cis3[0][9]) + ")" %></td>
								<td class=<%= if averages3[0][8]-averages1[0][8] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][8]-averages1[0][8]) + " (" + sprintf("%8.2f", ((averages3[0][8]-averages1[0][8]) / averages1[0][8]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "43" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Tile Drain Flow" + " (" + "in" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][9]).to_s + " (" + sprintf("%8.1f", cis1[0][10]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][9]) + " (" + sprintf("%8.1f", cis2[0][10]) + ")" %></td>
								<td class=<%= if averages2[0][9]-averages1[0][9] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][9]-averages1[0][9]).to_s + " (" + sprintf("%8.2f", ((averages2[0][9]-averages1[0][9]) / averages1[0][9]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][9]).to_s + " (" + sprintf("%8.1f", cis3[0][10]) + ")" %></td>
								<td class=<%= if averages3[0][9]-averages1[0][9] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][9]-averages1[0][9]).to_s + " (" + sprintf("%8.2f", ((averages3[0][9]-averages1[0][9]) / averages1[0][9]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<%# Other Flow values %>
						<% row_id = t + "row" + "50" %>
						<tr class="gvRowStyleOdd", id = <%=row_id%>>
							<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
								<%= "Total Other Water Info" + " (" + "in" + ")" %>
								<%= check_box_tag "Total P" %>
							</th>
							<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.1f", averages1[0][10]+averages1[0][11]) + " (" + sprintf("%8.1f", cis1[0][11]+cis1[0][12]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvTotalText" style="background-color:#DEFFFD"><%= sprintf("%8.1f", averages2[0][10]+averages2[0][11]) + " (" + sprintf("%8.1f", cis2[0][11]+cis2[0][12]) + ")" %></td>
								<% difference1 = averages2[0][10]+averages2[0][11]-(averages1[0][10]+averages1[0][11]) %>
								<% reduction1 = difference1 / (averages1[0][10]+averages1[0][11]) * 100 %>
								<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
							<% end %>
							<% if @scenario3 > "0" then %>
								<td class="gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", averages3[0][10]+averages3[0][11]) + " (" + sprintf("%8.1f", cis3[0][11]+cis3[0][12]) + ")" %></td>
								<% difference1 = averages3[0][10]+averages3[0][11]-(averages1[0][10]+averages1[0][11]) %>
								<% reduction1 = difference1 / (averages1[0][10]+averages1[0][11]) * 100 %>
								<td class= "gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "51" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Irrigation Runoff" + " (" + "in" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][10]) + " (" + sprintf("%8.1f", cis1[0][11]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][10]) + " (" + sprintf("%8.1f", cis2[0][11]) + ")" %></td>
								<td class=<%= if averages2[0][10]-averages1[0][10] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][10]-averages1[0][10]) + " (" + sprintf("%8.2f", ((averages2[0][10]-averages1[0][10]) / averages1[0][10]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][10]) + " (" + sprintf("%8.1f", cis3[0][11]) + ")" %></td>
								<td class=<%= if averages3[0][10]-averages1[0][10] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][10]-averages1[0][10]) + " (" + sprintf("%8.2f", ((averages3[0][10]-averages1[0][10]) / averages1[0][10]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "52" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Deep Percolation" + " (" + "in" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.2f", averages1[0][11]) + " (" + sprintf("%8.1f", cis1[0][12]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][11]) + " (" + sprintf("%8.1f", cis2[0][12]) + ")" %></td>
								<td class=<%= if averages2[0][11]-averages1[0][11] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", averages2[0][11]-averages1[0][11]) + " (" + sprintf("%8.2f", ((averages2[0][11]-averages1[0][11]) / averages1[0][11]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][11]) + " (" + sprintf("%8.1f", cis3[0][12]) + ")" %></td>
								<td class=<%= if averages3[0][11]-averages1[0][11] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", averages3[0][11]-averages1[0][11]) + " (" + sprintf("%8.2f", ((averages3[0][11]-averages1[0][11]) / averages1[0][11]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<%# Erosion %>
						<% row_id = t + "row" + "60" %>
						<tr class="gvRowStyleOdd", id = <%=row_id%>>
							<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
								<%= "Total Sediment" + " (" + "t/ac" + ")" %>
								<%= check_box_tag "Total P" %>
							</th>
							<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.1f", averages1[0][12]+averages1[0][13]) + " (" + sprintf("%8.1f", cis1[0][13]+cis1[0][14]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvTotalText" style="background-color:#DEFFFD"><%= sprintf("%8.1f", averages2[0][12]+averages2[0][13]) + " (" + sprintf("%8.1f", cis2[0][13]+cis2[0][14]) + ")" %></td>
								<% difference1 = averages2[0][12]+averages2[0][13]-(averages1[0][12]+averages1[0][13]) %>
								<% reduction1 = difference1 / (averages1[0][12]+averages1[0][13]) * 100 %>
								<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
							<% end %>
							<% if @scenario3 > "0" then %>
								<td class="gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", averages3[0][12]+averages3[0][13]) + " (" + sprintf("%8.1f", cis2[0][13]+cis2[0][14]) + ")" %></td>
								<% difference1 = averages3[0][12]+averages3[0][13]-(averages1[0][12]+averages1[0][13]) %>
								<% reduction1 = difference1 / (averages1[0][12]+averages1[0][13]) * 100 %>
								<td class= "gvTotalText" style="background-color:#CADCFF"><%= sprintf("%8.1f", difference1) + " (" + sprintf("%8.1f", reduction1) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "61" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Surface Erosion" + " (" + "t/ac" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.4f", averages1[0][12]) + " (" + sprintf("%8.1f", cis1[0][13]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.4f", averages2[0][12]) + " (" + sprintf("%8.1f", cis2[0][13]) + ")" %></td>
								<td class=<%= if averages2[0][12]-averages1[0][12] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.4f", averages2[0][12]-averages1[0][12]) + " (" + sprintf("%8.2f", ((averages2[0][12]-averages1[0][12]) / averages1[0][12]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.4f", averages3[0][12]) + " (" + sprintf("%8.1f", cis3[0][13]) + ")" %></td>
								<td class=<%= if averages3[0][12]-averages1[0][12] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.4f", averages3[0][12]-averages1[0][12]) + " (" + sprintf("%8.2f", ((averages3[0][12]-averages1[0][12]) / averages1[0][12]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<% row_id = t + "row" + "62" %>
						<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
							<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= "Manure Erosion" + " (" + "t/ac" + ")" %></th>
							<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.4f", averages1[0][13]).to_s + " (" + sprintf("%8.1f", cis1[0][14]) + ")" %></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.4f", averages2[0][13]) + " (" + sprintf("%8.1f", cis2[0][14]) + ")" %></td>
								<td class=<%= if averages2[0][13]-averages1[0][13] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.4f", averages2[0][13]-averages1[0][13]) + " (" + sprintf("%8.2f", ((averages2[0][13]-averages1[0][13]) / averages1[0][13]) * 100) + ")" %></td>
							<% end %>
							<% if @scenario3 != "0" && @scenario3 != "" then %>
								<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.4f", averages3[0][13]) + " (" + sprintf("%8.1f", cis3[0][14]) + ")" %></td>
								<td class=<%= if averages3[0][13]-averages1[0][13] <= 0 then "nutrients_positive bottom_border" else "nutrients_negative bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.4f", averages3[0][13]-averages1[0][13]) + " (" + sprintf("%8.2f", ((averages3[0][13]-averages1[0][13]) / averages1[0][13]) * 100) + ")" %></td>
							<% end %>
						</tr>
						<%# Crops %>
						<% row_id = t + "row" + "70" %>
						<tr class="gvRowStyleOdd", id = <%=row_id%>>
							<th class="gvTotalText" style="border-right: thick double #ff0000; text-align:left">
								<%= "Crop Yield"  %>
								<%= check_box_tag "Crop Yield" %>
							</th>
							<td class="gvTotalText" style="border-right: thick double #ff0000; background-color:#FFE8F9"></td>
							<% if @scenario2 != "0" && @scenario2 != "" then %>
								<td class="gvTotalText" style="background-color:#DEFFFD"></td>
								<td class= "gvTotalText" style="border-right: thick double #ff0000; background-color:#DEFFFD"></td>
							<% end %>
							<% if @scenario3 > "0" then %>
								<td class="gvTotalText" style="background-color:#CADCFF"></td>
								<td class= "gvTotalText" style="background-color:#CADCFF"></td>
							<% end %>
						</tr>
						<%# Determine the number of crops to list them and the stress values %>
						<% i = 1 %>
						<% crop_results.each do |cr| %>
							<%# get conversion unit dry matter to calculate yield and also take the unts %>
							<% crop = Crop.find_by_code(cr["name"]) %>
						    <% conversion_factor = 1 * AC_TO_HA %>
						    <% dry_matter = 100 %>
						    <% unit = "t/ac" %>
							<% if crop != nil then %>
						      <% conversion_factor = crop.conversion_factor * AC_TO_HA %>
						      <% dry_matter = crop.dry_matter %>
						      <% unit = crop.yield_unit + "/ac" %>
							<% end %>
							<% row_id = t + "row" + (70 + i).to_s %>
							<tr class="gvRowStyleEven" id = <%=row_id%> style="display:none">
								<th class="gvDetailText bottom_border" style="border-right: thick double #ff0000"><%= crop.name + " (" + unit + ")" %></th>
								<td class="gvCellStyleNumber bottom_border" style="border-right: thick double #ff0000; background-color:#FFE8F9"><%= sprintf("%8.0f", cr["yield1"] * total_area * conversion_factor / (dry_matter/100)) + " (" + sprintf("%8.1f", cr["ci1"]) + ")" %></td>
								<% if @scenario2 != "0" && @scenario2 != "" then %>
									<td class="gvCellStyleNumber bottom_border" style="background-color:#DEFFFD"><%= sprintf("%8.0f", cr["yield2"] * total_area * conversion_factor / (dry_matter/100)).to_s + " (" + sprintf("%8.1f", cr["ci2"]) + ")" %></td>
									<td class=<%= if cr["yield2"]-cr["yield1"] <= 0 then "nutrients_negative bottom_border" else "nutrients_positive bottom_border" end %> style="border-right: thick double #ff0000; background-color:#DEFFFD"><%= sprintf("%8.2f", cr["yield2"]-cr["yield1"]) + " (" + sprintf("%8.2f", (cr["yield2"]-cr["yield1"]) * 100 / cr["yield1"]) + ")" unless cr["yield1"]==0 %></td>
								<% end %>
								<% if @scenario3 != "0" && @scenario3 != "" then %>
									<td class="gvCellStyleNumber bottom_border" style="background-color:#CADCFF"><%= sprintf("%8.0f", cr["yield3"] * total_area * conversion_factor / (dry_matter/100)).to_s + " (" + sprintf("%8.1f", cr["ci3"]) + ")" %></td>
									<td class=<%= if cr["yield3"]-cr["yield1"] <= 0 then "nutrients_negative bottom_border" else "nutrients_positive bottom_border" end %> style="background-color:#CADCFF"><%= sprintf("%8.2f", cr["yield3"]-cr["yield1"]) + " (" + sprintf("%8.2f", (cr["yield3"]-cr["yield1"] * 100) / cr["yield1"]) + ")" unless cr["yield1"]==0 %></td>
								<% end %>
							</tr>
							<% i += 1 %>
						<% end %>
					<% end %>
				<%# end %>   <!-- if @results1 != nil && @present -->
				<!--Crop result here -->
				<% id = 70%>
			</tbody>
		</table>
	  </div>
	</div>
<% elsif @type.include? t('result.annual') or @type.include? t('result.monthly') then %>
	<% scenario1_name = "" %>
	<% scenario2_name = "" %>
	<% scenario3_name = "" %>
	<% if session[:simulation] == 'scenario' %>
		<% if !(@scenario1 == "0" || @scenario1 == "") then scenario1_name = Scenario.find(@scenario1).name end%>
		<% if !(@scenario2 == "0" || @scenario2 == "") then scenario2_name = Scenario.find(@scenario2).name end%>
		<% if !(@scenario3 == "0" || @scenario3 == "") then scenario3_name = Scenario.find(@scenario3).name end%>
	<% else %>
		<% if !(@scenario1 == "0" || @scenario1 == "") then scenario1_name = Watershed.find(@scenario1).name end%>
		<% if !(@scenario2 == "0" || @scenario2 == "") then scenario2_name = Watershed.find(@scenario2).name end%>
		<% if !(@scenario3 == "0" || @scenario3 == "") then scenario3_name = Watershed.find(@scenario3).name end%>
	<% end %>
	<% @title += " " + t('result.upto12') %>
  	<strong><h4><%= @title %></h4></strong>
  	<%= javascript_include_tag "//www.google.com/jsapi", "chartkick" %>
        <%= column_chart [
        { :name => scenario1_name, :data => @charts1 },
        { :name => scenario2_name, :data => @charts2 },
        { :name => scenario3_name, :data => @charts3 }
        ], { library: {hAxis: {title: @x}, vAxis: {title: @y}}}
        %>
    	<br/>
    <div class="table-responsive">
    	<table class='table table-bordered' style="white-space: nowrap;">
	        <% if (@present1 || @present2 || @present3)  %>
				<thead>
				  <tr class='gvHeaderStyle'>
					<th class='gvCellStyle Title'><%= t('models.scenario') %></th>
					<% case true %>
						<% when @present1 %>
							<% for i in 0..@charts1.count - 1 %><th class='gvCellStyle Title'><%= @charts1[i][0] %></th><% end %>
						<% when @present2 %>
							<% for i in 0..@charts2.count - 1 %><th class='gvCellStyle Title'><%= @charts2[i][0] %></th><% end %>
						<% when @present3 %>
							<% for i in 0..@charts3.count - 1 %><th class='gvCellStyle Title'><%= @charts3[i][0] %></th><% end %>
					<% end %>
				  </tr>
				</thead>
		        <tbody>
		          <% if @present1 %>
		            <tr class="gvRowStyleOdd">
		              <td class="gvTotalText">
		                <% if session[:simulation] != 'scenario' %>
		                  <%= Watershed.find(@scenario1).name %>
		                <% else %>
		                  <%= Scenario.find(@scenario1).name %>
		                <% end %>
		                </td>
						<% for i in 0..@charts1.count - 1 %>
							<td class='gvCellStyle Title'><%= @charts1[i][1].round(1) %></td>
						<% end %>
		            </tr>
		          <% end %>
		          <% if @present2 %>
		            <tr class="gvRowStyleEven">
		              <td class="gvTotalText">
		              	<% if session[:simulation] != 'scenario' %>
		                  <%= Watershed.find(@scenario2).name %>
		                <% else %>
		                  <%= Scenario.find(@scenario2).name %>
		                <% end %>
		              </td>
						<% for i in 0..@charts2.count - 1 %>
							<td class='gvCellStyle Title'><%= @charts2[i][1].round(1)  %></td>
						<% end %>
		            </tr>
		          <% end %>
		          <% if @present3 %>
		            <tr class="gvRowStyleOdd">
		              	<td class="gvTotalText">
			              	<% if session[:simulation] != 'scenario' %>
			                  <%= Watershed.find(@scenario3).name %>
			                <% else %>
			                  <%= Scenario.find(@scenario3).name %>
			                <% end %>
		              	</td>
						<% for i in 0..@charts3.count - 1 %>
							<td class='gvCellStyle Title'><%= @charts3[i][1].round(1)  %></td>
						<% end %>
		            </tr>
		          <% end %>
		        </tbody>
	        <% end %>
    	</table>
    </div>
<% end %>

 <br>

 <div id="pop-up-1" class="description_pop-up">
   <p>Average annual of combined organic, runoff, subsurface, and tile drainage N</p>
 </div>

 <div id="pop-up-2" class="description_pop-up">
   <p>Average annual rate of organic N loss with sediment</p>
 </div>

 <div id="pop-up-3" class="description_pop-up">
   <p>Average annual rate of soluble N loss with surface runoff</p>
 </div>

 <div id="pop-up-4" class="description_pop-up">
   <p>Average annual rate of soluble N loss in subsurface flow</p>
 </div>

 <div id="pop-up-5" class="description_pop-up">
   <p>Average annual rate of soluble N loss with tile flow</p>
 </div>

 <div id="pop-up-6" class="description_pop-up">
   <p>Average annual rate of organic P loss with sediment</p>
 </div>

 <div id="pop-up-7" class="description_pop-up">
   <p>Average annual rate of soluble P loss with surface runoff</p>
 </div>

 <div id="pop-up-8" class="description_pop-up">
   <p>Average annual rate of soluble P loss with tile flow</p>
 </div>

 <div id="pop-up-9" class="description_pop-up">
   <p>Average annual surface runoff</p>
 </div>

 <div id="pop-up-10" class="description_pop-up">
   <p>Average annual of subsurface flow</p>
 </div>

 <div id="pop-up-11" class="description_pop-up">
   <p>Average annual tile drain runoff</p>
 </div>

 <div id="pop-up-12" class="description_pop-up">
   <p>Average annual applied irrigation</p>
 </div>

 <div id="pop-up-13" class="description_pop-up">
   <p>Annual average deep perculated water</p>
 </div>

 <div id="pop-up-14" class="description_pop-up">
   <p>Average annual rate of soil erosion from soil surface</p>
 </div>

 <div id="pop-up-15" class="description_pop-up">
   <p>Average annual rate of manure erosion from soil surface</p>
 </div>

 <div id="pop-up-16" class="description_pop-up">
   <p>Average annual rate of harvested crop yield</p>
 </div>

 <div id="pop-up-17" class="description_pop-up">
   <p>This is the N stress level- the higher number means the higher crop N defficiency</p>
 </div>

 <div id="pop-up-18" class="description_pop-up">
   <p>This is the P stress level- the higher number means the higher crop P defficiency</p>
 </div>

 <div id="pop-up-19" class="description_pop-up">
   <p>This is the temperature stress level- the higher number means the higher crop heat unit defficiency</p>
 </div>

 <div id="pop-up-20" class="description_pop-up">
   <p>This is the water stress level- the higher number means the higher crop water defficiency</p>
 </div>

 <div id="pop-up-21" class="description_pop-up">
   <p>Average annual percipitation</p>
 </div>

 <div id="pop-up-22" class="description_pop-up">
   <p>Average annual surface runoff</p>
 </div>

 <div id="pop-up-23" class="description_pop-up">
   <p>Average annual of subsurface flow</p>
 </div>

 <div id="pop-up-24" class="description_pop-up">
   <p>Average annual tile drain runoff</p>
 </div>

 <div id="pop-up-25" class="description_pop-up">
   <p>Average annual of combined organic, runoff, subsurface, and tile drainage N</p>
 </div>

 <div id="pop-up-26" class="description_pop-up">
   <p>Average annual rate of organic N loss with sediment </p>
 </div>

 <div id="pop-up-27" class="description_pop-up">
   <p>Average annual rate of soluble N loss with surface runoff </p>
 </div>

 <div id="pop-up-28" class="description_pop-up">
   <p>Average annual rate of soluble N loss in subsurface flow </p>
 </div>

 <div id="pop-up-29" class="description_pop-up">
   <p>Average annual rate of soluble N loss with tile flow</p>
 </div>

 <div id="pop-up-30" class="description_pop-up">
   <p>Average annual rate of soluble N2O loss with tile flow</p>
 </div>

 <div id="pop-up-31" class="description_pop-up">
   <p>Average annual rate of organic P loss with sediment</p>
 </div>

 <div id="pop-up-32" class="description_pop-up">
   <p>Average annual rate of soluble P loss with surface runoff</p>
 </div>

 <div id="pop-up-33" class="description_pop-up">
   <p>Average annual rate of soluble P loss with tile flow</p>
 </div>

 <div id="pop-up-34" class="description_pop-up">
   <p>Average annual rate of soil erosion from soil surface</p>
 </div>

 <div id="pop-up-35" class="description_pop-up">
   <p>Average annual rate of manure erosion from soil surface</p>
 </div>

 <div id="pop-up-36" class="description_pop-up">
   <p>Average monthly  rate of organic N loss with sediment </p>
 </div>

 <div id="pop-up-37" class="description_pop-up">
   <p>Average monthly rate of soluble N loss with surface runoff </p>
 </div>

 <div id="pop-up-38" class="description_pop-up">
   <p>Average monthly rate of soluble N loss in subsurface flow </p>
 </div>

 <div id="pop-up-39" class="description_pop-up">
   <p>Average monthly rate of soluble N loss with tile flow</p>
 </div>

 <div id="pop-up-40" class="description_pop-up">
   <p>Average monthly rate of soluble N2O loss with tile flow</p>
 </div>

 <div id="pop-up-41" class="description_pop-up">
   <p>Average monthly  rate of soil erosion from soil surface</p>
 </div>

<%= hidden_field_tag "errors", @errors, { :id => "errors" } %>

<script>
  var elementIDNum = 0;
  $('[id^=show').hover(function() {
    //extracts id # from id of element clicked (e.g. checkbox_3 = 3)
    elementIDNum = (this.id).replace(/[^0-9]+/g, "");
    var check = $("#show"+elementIDNum);
    var moveLeft = -300;
    var moveDown = -80;
    $('div#pop-up-'+elementIDNum).show();
    $(this).mousemove(function(e) {
      $("div#pop-up-"+elementIDNum).css('top', e.pageY + moveDown).css('left', e.pageX + moveLeft);
    });
  }, function() {
      $('div#pop-up-'+elementIDNum).hide();
  });
</script>
